<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Analyst | Crypto Sectors</title>
  <link rel="icon" type="image/jpeg" href="favicon.jpg">
  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: #1a1a24;
      --text-primary: #ffffff;
      --text-secondary: #a0a0a0;
      --accent: #6366f1;
      --accent-hover: #818cf8;
      --green: #22c55e;
      --red: #ef4444;
      --yellow: #eab308;
      --border: #2a2a3a;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
    }

    .header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .header a {
      color: var(--accent);
      text-decoration: none;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem;
    }

    .ai-status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 1.5rem;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--green);
    }

    .status-dot.offline {
      background: var(--red);
    }

    .chat-container {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
    }

    .chat-header {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-header h2 {
      font-size: 1rem;
      font-weight: 500;
    }

    .quick-actions {
      display: flex;
      gap: 0.5rem;
    }

    .quick-btn {
      padding: 0.5rem 1rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      color: var(--text-primary);
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .quick-btn:hover {
      background: var(--accent);
      border-color: var(--accent);
    }

    .chat-messages {
      height: 400px;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .message {
      max-width: 85%;
      padding: 0.75rem 1rem;
      border-radius: 12px;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    .message.user {
      background: var(--accent);
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }

    .message.ai {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }

    .message.loading {
      color: var(--text-secondary);
    }

    .message.error {
      background: rgba(239, 68, 68, 0.1);
      border-color: var(--red);
      color: var(--red);
    }

    .chat-input {
      padding: 1rem;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 0.75rem;
    }

    .chat-input input {
      flex: 1;
      padding: 0.75rem 1rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 1rem;
    }

    .chat-input input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .chat-input input::placeholder {
      color: var(--text-secondary);
    }

    .send-btn {
      padding: 0.75rem 1.5rem;
      background: var(--accent);
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .send-btn:hover {
      background: var(--accent-hover);
    }

    .send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .digest-section {
      margin-top: 2rem;
    }

    .digest-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 1rem;
    }

    .digest-header {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .digest-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 500;
    }

    .generate-btn {
      padding: 0.5rem 1rem;
      background: var(--accent);
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .generate-btn:hover {
      background: var(--accent-hover);
    }

    .generate-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .digest-content {
      padding: 1rem;
      min-height: 100px;
      color: var(--text-secondary);
      white-space: pre-wrap;
      line-height: 1.6;
    }

    .digest-content.loaded {
      color: var(--text-primary);
    }

    .examples {
      margin-top: 2rem;
      padding: 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
    }

    .examples h3 {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
    }

    .example-questions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .example-q {
      padding: 0.5rem 0.75rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      color: var(--text-primary);
      transition: all 0.2s;
    }

    .example-q:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      .quick-actions {
        display: none;
      }
      .chat-messages {
        height: 300px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üß† AI Analyst</h1>
    <a href="/">‚Üê Dashboard</a>
  </div>

  <div class="container">
    <div class="ai-status" id="aiStatus">
      <div class="status-dot offline" id="statusDot"></div>
      <span id="statusText">–ü—Ä–æ–≤–µ—Ä–∫–∞ AI...</span>
    </div>

    <!-- Chat -->
    <div class="chat-container">
      <div class="chat-header">
        <h2>–°–ø—Ä–æ—Å–∏ AI –æ —Ä—ã–Ω–∫–µ</h2>
        <div class="quick-actions">
          <button class="quick-btn" onclick="askQuick('hot')">–ì–æ—Ä—è—á–∏–µ —Å–µ–∫—Ç–æ—Ä—ã</button>
          <button class="quick-btn" onclick="askQuick('cold')">–•–æ–ª–æ–¥–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä—ã</button>
          <button class="quick-btn" onclick="askQuick('idea')">–¢–æ—Ä–≥–æ–≤–∞—è –∏–¥–µ—è</button>
        </div>
      </div>
      <div class="chat-messages" id="chatMessages">
        <div class="message ai">
          –ü—Ä–∏–≤–µ—Ç! –Ø AI-–∞–Ω–∞–ª–∏—Ç–∏–∫ –∫—Ä–∏–ø—Ç–æ-—Å–µ–∫—Ç–æ—Ä–æ–≤. –°–ø—Ä–æ—Å–∏ –º–µ–Ω—è –æ:
‚Ä¢ –¢–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–µ–∫—Ç–æ—Ä–æ–≤
‚Ä¢ –ì–æ—Ä—è—á–∏—Ö/—Ö–æ–ª–æ–¥–Ω—ã—Ö –Ω–∞—Ä—Ä–∞—Ç–∏–≤–∞—Ö
‚Ä¢ –¢–æ—Ä–≥–æ–≤—ã—Ö –∏–¥–µ—è—Ö
‚Ä¢ –ê–Ω–∞–ª–∏–∑–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞</div>
      </div>
      <div class="chat-input">
        <input type="text" id="questionInput" placeholder="–ö–∞–∫–∏–µ —Å–µ–∫—Ç–æ—Ä—ã —Å–µ–π—á–∞—Å —Ä–∞—Å—Ç—É—Ç?" onkeypress="handleKeyPress(event)">
        <button class="send-btn" id="sendBtn" onclick="sendQuestion()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </div>

    <!-- Example questions -->
    <div class="examples">
      <h3>–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:</h3>
      <div class="example-questions">
        <span class="example-q" onclick="setQuestion(this.textContent)">–ö–∞–∫–æ–π —Å–µ–∫—Ç–æ—Ä —Å–µ–π—á–∞—Å —Å–∞–º—ã–π –≥–æ—Ä—è—á–∏–π?</span>
        <span class="example-q" onclick="setQuestion(this.textContent)">–°—Ç–æ–∏—Ç –ª–∏ –≤—Ö–æ–¥–∏—Ç—å –≤ AI –∞–≥–µ–Ω—Ç–æ–≤?</span>
        <span class="example-q" onclick="setQuestion(this.textContent)">–ö–∞–∫–∏–µ –º–µ–º–∫–æ–∏–Ω—ã —Ä–∞—Å—Ç—É—Ç?</span>
        <span class="example-q" onclick="setQuestion(this.textContent)">–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å DeFi?</span>
        <span class="example-q" onclick="setQuestion(this.textContent)">–ö—É–¥–∞ —Ä–æ—Ç–∏—Ä—É—é—Ç –∫–∞–ø–∏—Ç–∞–ª?</span>
      </div>
    </div>

    <!-- Digests -->
    <div class="digest-section">
      <div class="digest-card">
        <div class="digest-header">
          <div class="digest-title">üåÖ –î–Ω–µ–≤–Ω–æ–π –¥–∞–π–¥–∂–µ—Å—Ç</div>
          <button class="generate-btn" id="dailyBtn" onclick="generateDigest('daily')">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        <div class="digest-content" id="dailyContent">
          –ù–∞–∂–º–∏—Ç–µ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å" –¥–ª—è AI-–æ–±–∑–æ—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è
        </div>
      </div>

      <div class="digest-card">
        <div class="digest-header">
          <div class="digest-title">üìÖ –ù–µ–¥–µ–ª—å–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç</div>
          <button class="generate-btn" id="weeklyBtn" onclick="generateDigest('weekly')">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        <div class="digest-content" id="weeklyContent">
          –ù–∞–∂–º–∏—Ç–µ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å" –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ AI-–∞–Ω–∞–ª–∏–∑–∞ –Ω–µ–¥–µ–ª–∏
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = '/api/ai';
    let aiAvailable = false;

    // Check AI status
    async function checkStatus() {
      try {
        const res = await fetch(`${API_URL}/status`);
        const data = await res.json();
        aiAvailable = data.available;

        const dot = document.getElementById('statusDot');
        const text = document.getElementById('statusText');

        if (aiAvailable) {
          dot.classList.remove('offline');
          text.textContent = `AI Online (${data.model})`;
        } else {
          dot.classList.add('offline');
          text.textContent = 'AI Offline';
        }
      } catch (e) {
        document.getElementById('statusDot').classList.add('offline');
        document.getElementById('statusText').textContent = 'AI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
      }
    }

    // Add message to chat
    function addMessage(text, type = 'ai') {
      const container = document.getElementById('chatMessages');
      const msg = document.createElement('div');
      msg.className = `message ${type}`;
      msg.textContent = text;
      container.appendChild(msg);
      container.scrollTop = container.scrollHeight;
      return msg;
    }

    // Send question
    async function sendQuestion() {
      const input = document.getElementById('questionInput');
      const question = input.value.trim();
      if (!question) return;

      input.value = '';
      addMessage(question, 'user');

      const loadingMsg = addMessage('–î—É–º–∞—é...', 'ai loading');
      document.getElementById('sendBtn').disabled = true;

      try {
        const res = await fetch(`${API_URL}/ask`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question })
        });

        const data = await res.json();
        loadingMsg.remove();

        if (data.success) {
          addMessage(data.answer, 'ai');
        } else {
          addMessage(`–û—à–∏–±–∫–∞: ${data.error}`, 'ai error');
        }
      } catch (e) {
        loadingMsg.remove();
        addMessage(`–û—à–∏–±–∫–∞: ${e.message}`, 'ai error');
      }

      document.getElementById('sendBtn').disabled = false;
    }

    // Handle Enter key
    function handleKeyPress(e) {
      if (e.key === 'Enter') sendQuestion();
    }

    // Set question from example
    function setQuestion(text) {
      document.getElementById('questionInput').value = text;
      document.getElementById('questionInput').focus();
    }

    // Quick questions
    function askQuick(type) {
      const questions = {
        hot: '–ö–∞–∫–∏–µ 3 —Å–µ–∫—Ç–æ—Ä–∞ —Å–µ–π—á–∞—Å —Å–∞–º—ã–µ –≥–æ—Ä—è—á–∏–µ –∏ –ø–æ—á–µ–º—É?',
        cold: '–ö–∞–∫–∏–µ —Å–µ–∫—Ç–æ—Ä—ã —Å–µ–π—á–∞—Å —Ö–æ–ª–æ–¥–Ω—ã–µ –∏ —Å—Ç–æ–∏—Ç –ª–∏ –∏—Ö –ø–æ–∫—É–ø–∞—Ç—å?',
        idea: '–î–∞–π —Ç–æ—Ä–≥–æ–≤—É—é –∏–¥–µ—é –Ω–∞ —Å–µ–≥–æ–¥–Ω—è —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º'
      };
      setQuestion(questions[type]);
      sendQuestion();
    }

    // Generate digest
    async function generateDigest(type) {
      const btn = document.getElementById(`${type}Btn`);
      const content = document.getElementById(`${type}Content`);

      btn.disabled = true;
      btn.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...';
      content.textContent = 'AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ...';
      content.classList.remove('loaded');

      try {
        const res = await fetch(`${API_URL}/${type}-digest`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });

        const data = await res.json();

        if (data.success) {
          content.textContent = data.digest;
          content.classList.add('loaded');
        } else {
          content.textContent = `–û—à–∏–±–∫–∞: ${data.error}`;
        }
      } catch (e) {
        content.textContent = `–û—à–∏–±–∫–∞: ${e.message}`;
      }

      btn.disabled = false;
      btn.textContent = '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å';
    }

    // Init
    checkStatus();
  </script>
</body>
</html>
